---
title: "Foundations of Probability and Statistics, Project"
author: "Emiliano Capasso, Antonello Scarcella, Simone Bellavia"
date: '2022-12-05'
geometry: "left=2cm,right=2cm,top=0.5cm,bottom=1.5cm"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning=FALSE,
                      message=FALSE,
                      tidy.opts=list(width.cutoff = 80),
                      tidy = TRUE)
library(tidyverse) # for tidyverse
library(caret) # for createDataPartition
library(performance) # for compare_performance
library(ggplot2) # for plots
library(reshape2) # for melt function
library(gridExtra) # to arrange plots in a grid 
library(factoextra) # for PCA
library(corrplot) # for correlation between variables and PCA
```

# Introduction to Analysis

TBD

# Descriptive Analysis

TBD

## Importing data

```{r}
# import data
data <- read.csv("data.csv",
                    header = TRUE)
```

## First exploration

```{r}
# get structure of dataset
str(data)
```

- id: id number
- diagnosis (response): the diagnosis of breast tissues (M = malignant, B = benign)
- radius_mean: mean of distances from center to points on the perimeter
- texture_mean: standard deviation of gray-scale values
- perimeter_mean: mean size of the core tumor
- area_mean: //
- smoothness_mean: mean of local variation in radius lengths
- compactness_mean: mean of perimeter^2 / area - 1.0
- concavity_mean: mean of severity of concave portions of the contour
- concave points_mean: mean for number of concave portions of the contour
- ecc.

```{r}
# get summary of variables
summary(data)
```

```{r}
# getting the head of dataset
head(data)
```

## Missing Values

Checking if there are missing values:

```{r}
# check for missing values
colSums(is.na(data))
```

There aren't missing values in the considered dataset, except for 32th feature 'X' that is full of NA, we drop it.

```{r}
data <- data %>% select(-X)
```

We also drop id because it is not needed

```{r}
data <- data %>% select(-id)
```

Checking if the column has been dropped.

```{r}
colnames(data)
```

## Second exploration

```{r}
describe(data)
```

Let's see the frequency of cancer diagnosis (if benignant or malignant)

```{r}
ggplot(data, aes(x = diagnosis)) + 
  geom_bar(aes(y = (..count..)/sum(..count..))) + 
  labs(x = "Diagnosis", y = "Frequency", title = "Frequency of Cancer Stages")
```

Benignant cancers are way more than malignant.

Converting the diagnosis values in numeric. Malignant == 1, Benign == 0.

```{r}
data$diagnosis <- as.numeric(data$diagnosis == "M")

str(data)
```

Let's see the correlation map with a heatmap.

```{r}
# Create correlation matrix
corr_matrix <- cor(data)

# Create heatmap
melted_matrix <- melt(corr_matrix)
ggplot(data = melted_matrix, aes(x = Var1, y = Var2, fill = value)) +
  geom_tile(color = "white") +
  scale_fill_gradient2(low = "blue", high = "red", mid = "white",
                       midpoint = 0, limit = c(-1,1), name = "Correlation") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  ggtitle("Correlation Map")
```

Features vs Diagnosis

```{r}
features_mean <- names(data)[2:12]

plots <- lapply(1:length(features_mean), function(x) {
  g <- ggplot(data, aes_string(x = features_mean[x], 
                              fill = as.factor(data$diagnosis))) +
    geom_histogram(binwidth = (max(data[,features_mean[x]]) - min(data[,features_mean[x]]))/50, 
                  alpha = 0.5, aes(color = as.factor(data$diagnosis))) +
    scale_fill_manual(values = c("green", "red")) +
    scale_color_manual(values = c("green", "red")) +
    ggtitle(features_mean[x]) +
    theme(plot.title = element_text(hjust = 0.5)) +
    labs(fill = "Diagnosis", color = "Diagnosis")
  return(g)
})

grid.arrange(grobs = plots, ncol = 2)
```

This code plots histograms of 10 features of a dataset with a binary diagnosis outcome. 
The histograms are stacked and show the distribution of each feature for each diagnosis type (red for "M" and green for "B"). 
The histograms are plotted in a 5x2 grid, with each feature in a separate plot and labeled with the feature name. 
The code uses ggplot2 library in R for plotting and gridExtra library for arranging the plots in a grid.
The resulting plot is a comparison of the distributions of each feature between the two diagnosis groups.

Mean values of texture, smoothness, symmetry or fractual dimension does not show a particular preference of one diagnosis over the other. 

## Reducing dimensionality

```{r}
# Exclude the response variable 'Diagnosis'
data_cont <- data[, which(colnames(data) != "diagnosis")]

# Scale th°e continuous features (if necessary)
data_cont_scaled <- scale(data_cont)

# Perform PCA on the scaled data
pca <- prcomp(data_cont_scaled)

# Summarize the results
summary(pca)

# Plot the first two principal components
plot(pca$x[,1:2], col=ifelse(data$Diagnosis==0, "blue", "red"),
     main="PCA of Continuous Features", xlab="PC1", ylab="PC2")
legend("topright", legend=c("B", "M"), col=c("blue", "red"), pch=1)
```

getting variables
```{r}

all_var <- get_pca_var(pca)
all_var

```

plotting correlations
```{r}

corrplot(all_var$cos2, is.corr = FALSE)

```

##

# Tests

TBD

# Linear Model

TBD

# Bibliography

[1] TBD